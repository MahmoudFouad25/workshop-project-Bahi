<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø­Ù…Ù„Ø© Ø±Ù…Ø¶Ø§Ù† | Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card .icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            font-size: 36px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #666;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .tab-btn:hover {
            background: #f0f0f0;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Section */
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        th {
            padding: 15px;
            text-align: right;
            font-weight: 600;
            font-size: 14px;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            margin-top: 20px;
        }
        
        .charts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    margin-top: 30px;
}

@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
}
        
        .chart-wrapper {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    transition: all 0.3s;
    height: 350px;
    display: flex;
    flex-direction: column;
}

.chart-wrapper:hover {
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    transform: translateY(-3px);
}

.chart-wrapper canvas {
    flex: 1;
    max-height: 280px;
}
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        /* Insight Cards */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #f6f9fc 0%, #eef2f7 100%);
            padding: 20px;
            border-radius: 10px;
            border-right: 5px solid #667eea;
        }
        
        .insight-card h3 {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .insight-card ul {
            list-style: none;
            padding: 0;
        }
        
        .insight-card li {
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        
        .insight-card li:last-child {
            border-bottom: none;
        }
        
        .insight-card .count {
            float: left;
            background: #667eea;
            color: white;
            padding: 2px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .empty-state-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        /* AI Analysis Section */
        .ai-analysis {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            border-right: 5px solid #ff9a76;
        }
        
        .ai-analysis h3 {
            color: #d84315;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .ai-analysis .analysis-text {
            background: white;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 15px;
        }
        
        /* Recommendation Cards */
        .recommendations {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .recommendation-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid #4caf50;
        }
        
        .recommendation-card h4 {
            color: #4caf50;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .recommendation-card p {
            color: #666;
            line-height: 1.6;
        }
        
        /* Priority Badge */
        .priority-high {
            background: #f44336;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-right: 10px;
        }
        
        .priority-medium {
            background: #ff9800;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-right: 10px;
        }
        
        .priority-low {
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-right: 10px;
        }
        
        /* Response Detail */
        .response-detail {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 25px;
    border-radius: 15px;
    margin: 20px 0;
    border-right: 5px solid #667eea;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    transition: all 0.3s;
}

.response-detail:hover {
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    transform: translateX(5px);
}

.response-detail h4 {
    color: #667eea;
    margin-bottom: 20px;
    font-size: 20px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 15px;
    border-bottom: 2px solid #eee;
}

.response-detail h4::before {
    content: 'ğŸ‘¤';
    font-size: 24px;
}

.response-detail .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.response-detail .info-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    border-right: 3px solid #e0e0e0;
}

.response-detail .info-item strong {
    display: block;
    color: #667eea;
    font-size: 13px;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.response-detail .info-item span {
    color: #333;
    font-size: 15px;
    font-weight: 500;
}

.response-detail .challenges-section {
    background: #fff3cd;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-right: 4px solid #ffc107;
}

.response-detail .challenges-section h5 {
    color: #856404;
    margin-bottom: 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.response-detail .challenges-section h5::before {
    content: 'âš ï¸';
}

.response-detail .challenges-section p {
    color: #856404;
    margin: 10px 0;
    padding: 10px;
    background: white;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.6;
}

.response-detail .needs-section {
    background: #d1ecf1;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-right: 4px solid #17a2b8;
}

.response-detail .needs-section h5 {
    color: #0c5460;
    margin-bottom: 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.response-detail .needs-section h5::before {
    content: 'ğŸ¯';
}

.response-detail .needs-section p {
    color: #0c5460;
    font-size: 14px;
    line-height: 1.6;
}

.response-detail .objections-section {
    background: #f8d7da;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-right: 4px solid #dc3545;
}

.response-detail .objections-section h5 {
    color: #721c24;
    margin-bottom: 15px;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.response-detail .objections-section h5::before {
    content: 'ğŸ’¬';
}

.response-detail .objections-section p {
    color: #721c24;
    margin: 10px 0;
    padding: 10px;
    background: white;
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.6;
}

.response-detail .timestamp {
    color: #999;
    font-size: 13px;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 8px;
}

.response-detail .timestamp::before {
    content: 'ğŸ•';
}
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø­Ù…Ù„Ø© Ø±Ù…Ø¶Ø§Ù† "Ø§Ù„Ù†Ø§Ø³ Ù„Ø¨Ø¹Ø¶Ù‡Ø§"</h1>
            <p>ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† | 58 Ù…Ù„ÙŠÙˆÙ† Ø¬Ù†ÙŠÙ‡ | 26 Ù…Ø­Ø§ÙØ¸Ø© | 5000 Ù…ØªØ·ÙˆØ¹</p>
        </div>
        
        <!-- Stats Overview -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="icon">ğŸ‘¥</div>
                <div class="number" id="total-responses">0</div>
                <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“</div>
                <div class="number" id="total-governorates">0</div>
                <div class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="icon">â­</div>
                <div class="number" id="avg-readiness">0</div>
                <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© (Ù…Ù† 5)</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“‹</div>
                <div class="number" id="with-plans">0%</div>
                <div class="label">Ù„Ø¯ÙŠÙ‡Ù… Ø®Ø·Ø© Ø¬Ø§Ù‡Ø²Ø©</div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div style="text-align: center; margin-bottom: 30px;">
            <button class="btn btn-success" onclick="exportToExcel()">
                ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
            </button>
            <button class="btn btn-primary" onclick="generateAIAnalysis()">
                ğŸ¤– ØªØ­Ù„ÙŠÙ„ AI Ù…ØªÙ‚Ø¯Ù…
            </button>
            <button class="btn btn-warning" onclick="location.reload()">
                ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('overview')">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
            <button class="tab-btn" onclick="showTab('responses')">ğŸ“‹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</button>
            <button class="tab-btn" onclick="showTab('challenges')">âš ï¸ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</button>
            <button class="tab-btn" onclick="showTab('objections')">ğŸ’¬ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª</button>
            <button class="tab-btn" onclick="showTab('needs')">ğŸ¯ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©</button>
            <button class="tab-btn" onclick="showTab('insights')">ğŸ’¡ Ø±Ø¤Ù‰ ÙˆØªÙˆØµÙŠØ§Øª</button>
        </div>
        
        <!-- Tab: Overview -->
        <div id="overview-tab" class="tab-content active">
            <div class="section">
                <h2 class="section-title">ğŸ“Š Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©</h2>
                
                <div class="charts-grid">
                    <div class="chart-wrapper">
                        <h3 class="chart-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</h3>
                        <canvas id="rolesChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</h3>
                        <canvas id="readinessChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ®Ø·ÙŠØ·</h3>
                        <canvas id="planningChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3 class="chart-title">ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª</h3>
                        <canvas id="targetsChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3 class="chart-title">ØªØ³ÙƒÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ø©</h3>
                        <canvas id="boardChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3 class="chart-title">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</h3>
                        <canvas id="volunteersChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab: Detailed Responses -->
        <div id="responses-tab" class="tab-content">
            <div class="section">
                <h2 class="section-title">ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
                <div id="responses-container"></div>
            </div>
        </div>
        
        <!-- Tab: Challenges -->
        <div id="challenges-tab" class="tab-content">
            <div class="section">
                <h2 class="section-title">âš ï¸ Ø£ÙƒØ¨Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©</h2>
                <div id="challenges-analysis"></div>
            </div>
        </div>
        
        <!-- Tab: Objections -->
        <div id="objections-tab" class="tab-content">
            <div class="section">
                <h2 class="section-title">ğŸ’¬ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</h2>
                <div id="objections-analysis"></div>
            </div>
        </div>
        
        <!-- Tab: Workshop Needs -->
        <div id="needs-tab" class="tab-content">
            <div class="section">
                <h2 class="section-title">ğŸ¯ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù…Ù† Ø§Ù„ÙˆØ±Ø´Ø©</h2>
                <div id="needs-analysis"></div>
            </div>
        </div>
        
        <!-- Tab: Insights -->
        <div id="insights-tab" class="tab-content">
            <div class="section">
                <h2 class="section-title">ğŸ’¡ Ø±Ø¤Ù‰ ÙˆØªÙˆØµÙŠØ§Øª Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ±Ø´Ø©</h2>
                <div id="insights-container"></div>
            </div>
        </div>
        
        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- Config -->
    <script src="../config.js"></script>
    
    <script>
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Global Data
        let allResponses = [];
        let charts = {};
        
        // Load Data
        async function loadData() {
            try {
                const snapshot = await db.collection('ramadan-campaign-survey')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                allResponses = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('Loaded responses:', allResponses.length);
                
                if (allResponses.length === 0) {
                    showEmptyState();
                    return;
                }
                
                // Update UI
                updateStats();
                createCharts();
                displayResponses();
                analyzeChallenges();
                analyzeObjections();
                analyzeNeeds();
                generateInsights();
                
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: red;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>';
            }
        }
        
        // Update Stats
        function updateStats() {
            // Total responses
            document.getElementById('total-responses').textContent = allResponses.length;
            
            // Unique governorates
            const governorates = new Set(allResponses.map(r => r.governorate).filter(g => g));
            document.getElementById('total-governorates').textContent = governorates.size;
            
            // Average readiness
            const readinessValues = allResponses
                .map(r => parseInt(r.readiness))
                .filter(r => !isNaN(r));
            const avgReadiness = readinessValues.length > 0 
                ? (readinessValues.reduce((a, b) => a + b, 0) / readinessValues.length).toFixed(1)
                : 0;
            document.getElementById('avg-readiness').textContent = avgReadiness;
            
            // With complete plans
            const withPlans = allResponses.filter(r => r.has_plan === 'Ù†Ø¹Ù…ØŒ Ø®Ø·Ø© ØªÙØµÙŠÙ„ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©').length;
            const planPercentage = allResponses.length > 0 
                ? Math.round((withPlans / allResponses.length) * 100)
                : 0;
            document.getElementById('with-plans').textContent = planPercentage + '%';
        }
        
        // Create Charts
        function createCharts() {
            createRolesChart();
            createReadinessChart();
            createPlanningChart();
            createTargetsChart();
            createBoardChart();
            createVolunteersChart();
        }
        
        function createRolesChart() {
            const ctx = document.getElementById('rolesChart');
            const roleCounts = countValues('role');
            
            charts.roles = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(roleCounts),
                    datasets: [{
                        data: Object.values(roleCounts),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#4facfe',
                            '#43e97b'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function createReadinessChart() {
            const ctx = document.getElementById('readinessChart');
            const readinessCounts = {};
            
            for (let i = 1; i <= 5; i++) {
                readinessCounts[i] = allResponses.filter(r => parseInt(r.readiness) === i).length;
            }
            
            charts.readiness = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1', '2', '3', '4', '5'],
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†',
                        data: Object.values(readinessCounts),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        function createPlanningChart() {
            const ctx = document.getElementById('planningChart');
            const planCounts = countValues('has_plan');
            
            charts.planning = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(planCounts),
                    datasets: [{
                        data: Object.values(planCounts),
                        backgroundColor: [
                            '#4caf50',
                            '#ff9800',
                            '#f44336',
                            '#9e9e9e'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function createTargetsChart() {
            const ctx = document.getElementById('targetsChart');
            const targetCounts = countValues('target_divided');
            
            charts.targets = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(targetCounts),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†',
                        data: Object.values(targetCounts),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        function createBoardChart() {
            const ctx = document.getElementById('boardChart');
            const boardCounts = countValues('board_setup');
            
            charts.board = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(boardCounts),
                    datasets: [{
                        data: Object.values(boardCounts),
                        backgroundColor: [
                            '#38ef7d',
                            '#ffd93d',
                            '#ff6b9d',
                            '#c471ed'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function createVolunteersChart() {
            const ctx = document.getElementById('volunteersChart');
            const volCounts = countValues('volunteers_count');
            
            charts.volunteers = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(volCounts),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†',
                        data: Object.values(volCounts),
                        backgroundColor: 'rgba(67, 233, 123, 0.8)',
                        borderColor: 'rgba(67, 233, 123, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Display Responses
        function displayResponses() {
    const container = document.getElementById('responses-container');
    
    if (allResponses.length === 0) {
        container.innerHTML = '<p class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>';
        return;
    }
    
    let html = '';
    
    allResponses.forEach((response, index) => {
        html += `
            <div class="response-detail">
                <h4>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ #${index + 1}: ${response.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h4>
                
                <div class="info-grid">
                    <div class="info-item">
                        <strong>ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</strong>
                        <span>${response.governorate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ‘” Ø§Ù„Ø¯ÙˆØ±</strong>
                        <span>${response.role || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${response.role_other ? '(' + response.role_other + ')' : ''}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ“Š Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</strong>
                        <span>${response.readiness ? response.readiness + ' Ù…Ù† 5' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${'â­'.repeat(parseInt(response.readiness) || 0)}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ“ Ø§Ù„Ø®Ø·Ø©</strong>
                        <span>${response.has_plan || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ¯ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª</strong>
                        <span>${response.target_divided || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ“… Timeline</strong>
                        <span>${response.has_timeline || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ‘¥ ØªØ³ÙƒÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ø©</strong>
                        <span>${response.board_setup || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    
                    <div class="info-item">
                        <strong>ğŸ™‹ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</strong>
                        <span>${response.volunteers_count || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                </div>
                
                ${(response.challenge_1 || response.challenge_2 || response.challenge_3) ? `
                    <div class="challenges-section">
                        <h5>Ø£ÙƒØ¨Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h5>
                        ${response.challenge_1 ? `<p><strong>1.</strong> ${response.challenge_1}</p>` : ''}
                        ${response.challenge_2 ? `<p><strong>2.</strong> ${response.challenge_2}</p>` : ''}
                        ${response.challenge_3 ? `<p><strong>3.</strong> ${response.challenge_3}</p>` : ''}
                    </div>
                ` : ''}
                
                ${response.workshop_needs && response.workshop_needs.length > 0 ? `
                    <div class="needs-section">
                        <h5>Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ±Ø´Ø©</h5>
                        <p>${response.workshop_needs.join(' â€¢ ')}</p>
                    </div>
                ` : ''}
                
                ${response.past_problem ? `
                    <div class="needs-section">
                        <h5>Ø£ÙƒØ¨Ø± Ù…Ø´ÙƒÙ„Ø© Ø³Ø§Ø¨Ù‚Ø©</h5>
                        <p>${response.past_problem}</p>
                    </div>
                ` : ''}
                
                ${response.success_example ? `
                    <div class="needs-section" style="background: #d4edda; border-right-color: #28a745;">
                        <h5 style="color: #155724;">âœ… Ù…Ø«Ø§Ù„ Ù†Ø§Ø¬Ø­</h5>
                        <p style="color: #155724;">${response.success_example}</p>
                    </div>
                ` : ''}
                
                ${response.needed_tools ? `
                    <div class="needs-section">
                        <h5>Ø£Ø¯ÙˆØ§Øª ÙˆÙ†Ù…Ø§Ø°Ø¬ Ù…Ø­ØªØ§Ø¬Ø©</h5>
                        <p>${response.needed_tools}</p>
                    </div>
                ` : ''}
                
                ${(response.volunteer_objections && response.volunteer_objections.length > 0) || 
                  (response.donor_objections && response.donor_objections.length > 0) ? `
                    <div class="objections-section">
                        <h5>Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª</h5>
                        ${response.volunteer_objections && response.volunteer_objections.length > 0 ? 
                            `<p><strong>ğŸ‘¥ Ù…Ù† Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†:</strong> ${response.volunteer_objections.join(' â€¢ ')}</p>` : ''}
                        ${response.donor_objections && response.donor_objections.length > 0 ? 
                            `<p><strong>ğŸ’° Ù…Ù† Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†:</strong> ${response.donor_objections.join(' â€¢ ')}</p>` : ''}
                    </div>
                ` : ''}
                
                ${response.volunteer_response || response.donor_response ? `
                    <div class="objections-section" style="background: #d1ecf1; border-right-color: #17a2b8;">
                        <h5 style="color: #0c5460;">ğŸ’¡ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª</h5>
                        ${response.volunteer_response ? 
                            `<p style="color: #0c5460;"><strong>Ø±Ø¯ Ø¹Ù„Ù‰ Ù…ØªØ·ÙˆØ¹ ØªØ¹Ø¨Ø§Ù†:</strong><br>"${response.volunteer_response}"</p>` : ''}
                        ${response.donor_response ? 
                            `<p style="color: #0c5460;"><strong>Ø±Ø¯ Ø¹Ù„Ù‰ Ù…ØªØ¨Ø±Ø¹ (Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØºØ§Ù„ÙŠØ©):</strong><br>"${response.donor_response}"</p>` : ''}
                    </div>
                ` : ''}
                
                ${response.final_question ? `
                    <div class="needs-section">
                        <h5>Ø±Ø³Ø§Ù„Ø©/Ø³Ø¤Ø§Ù„ Ø£Ø®ÙŠØ±</h5>
                        <p>${response.final_question}</p>
                    </div>
                ` : ''}
                
                <div class="timestamp">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${new Date(response.timestamp).toLocaleString('ar-EG', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}</div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}
        
        // Analyze Challenges
        function analyzeChallenges() {
            const container = document.getElementById('challenges-analysis');
            
            const allChallenges = [];
            allResponses.forEach(r => {
                if (r.challenge_1) allChallenges.push(r.challenge_1);
                if (r.challenge_2) allChallenges.push(r.challenge_2);
                if (r.challenge_3) allChallenges.push(r.challenge_3);
            });
            
            if (allChallenges.length === 0) {
                container.innerHTML = '<p class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ§Øª Ù…Ø°ÙƒÙˆØ±Ø©</p>';
                return;
            }
            
            // Count keywords in challenges
            const keywords = {};
            const commonWords = ['ÙÙŠ', 'Ù…Ù†', 'Ø¹Ù„Ù‰', 'Ø¥Ù„Ù‰', 'Ø£Ùˆ', 'Ùˆ', 'Ø§Ù„', 'Ù„Ø§', 'Ù…Ø§', 'Ù‡Ùˆ', 'Ù‡ÙŠ'];
            
            allChallenges.forEach(challenge => {
                const words = challenge.split(/\s+/)
                    .filter(w => w.length > 3 && !commonWords.includes(w));
                
                words.forEach(word => {
                    keywords[word] = (keywords[word] || 0) + 1;
                });
            });
            
            // Sort by frequency
            const sortedKeywords = Object.entries(keywords)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            let html = `
                <div class="insights-grid">
                    <div class="insight-card">
                        <h3>ğŸ”´ Ø£ÙƒØ«Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØªÙƒØ±Ø§Ø±Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h3>
                        <ul>
            `;
            
            sortedKeywords.forEach(([word, count]) => {
                html += `<li>${word} <span class="count">${count}</span></li>`;
            });
            
            html += `
                        </ul>
                    </div>
                    
                    <div class="insight-card">
                        <h3>ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            allChallenges.forEach((challenge, index) => {
                html += `<p style="padding: 8px 0; border-bottom: 1px solid #eee;">${index + 1}. ${challenge}</p>`;
            });
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Analyze Objections
        function analyzeObjections() {
            const container = document.getElementById('objections-analysis');
            
            const volObjections = {};
            const donObjections = {};
            
            allResponses.forEach(r => {
                if (r.volunteer_objections && Array.isArray(r.volunteer_objections)) {
                    r.volunteer_objections.forEach(obj => {
                        volObjections[obj] = (volObjections[obj] || 0) + 1;
                    });
                }
                
                if (r.donor_objections && Array.isArray(r.donor_objections)) {
                    r.donor_objections.forEach(obj => {
                        donObjections[obj] = (donObjections[obj] || 0) + 1;
                    });
                }
            });
            
            const sortedVol = Object.entries(volObjections).sort((a, b) => b[1] - a[1]);
            const sortedDon = Object.entries(donObjections).sort((a, b) => b[1] - a[1]);
            
            let html = `
                <div class="insights-grid">
                    <div class="insight-card">
                        <h3>ğŸ‘¥ Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</h3>
                        <ul>
            `;
            
            sortedVol.forEach(([obj, count]) => {
                html += `<li>${obj} <span class="count">${count}</span></li>`;
            });
            
            html += `
                        </ul>
                    </div>
                    
                    <div class="insight-card">
                        <h3>ğŸ’° Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹</h3>
                        <ul>
            `;
            
            sortedDon.forEach(([obj, count]) => {
                html += `<li>${obj} <span class="count">${count}</span></li>`;
            });
            
            html += `
                        </ul>
                    </div>
                </div>
                
                <div class="section" style="margin-top: 30px;">
                    <h3 class="section-title">ğŸ’¬ Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠØ©</h3>
            `;
            
            // Show sample responses
            const responsesWithAnswers = allResponses.filter(r => r.volunteer_response || r.donor_response);
            
            if (responsesWithAnswers.length > 0) {
                html += '<div class="insights-grid">';
                
                responsesWithAnswers.slice(0, 6).forEach(r => {
                    if (r.volunteer_response) {
                        html += `
                            <div class="insight-card">
                                <h3>Ø±Ø¯ Ø¹Ù„Ù‰ Ù…ØªØ·ÙˆØ¹ ØªØ¹Ø¨Ø§Ù†:</h3>
                                <p>"${r.volunteer_response}"</p>
                            </div>
                        `;
                    }
                    
                    if (r.donor_response) {
                        html += `
                            <div class="insight-card">
                                <h3>Ø±Ø¯ Ø¹Ù„Ù‰ Ù…ØªØ¨Ø±Ø¹ Ù‚Ø§Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØºØ§Ù„ÙŠØ©:</h3>
                                <p>"${r.donor_response}"</p>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
            }
            
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // Analyze Needs
        function analyzeNeeds() {
            const container = document.getElementById('needs-analysis');
            
            const needsCounts = {};
            
            allResponses.forEach(r => {
                if (r.workshop_needs && Array.isArray(r.workshop_needs)) {
                    r.workshop_needs.forEach(need => {
                        needsCounts[need] = (needsCounts[need] || 0) + 1;
                    });
                }
            });
            
            const sortedNeeds = Object.entries(needsCounts).sort((a, b) => b[1] - a[1]);
            
            let html = `
                <div class="insight-card">
                    <h3>ğŸ¯ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹</h3>
                    <ul>
            `;
            
            sortedNeeds.forEach(([need, count]) => {
                const percentage = Math.round((count / allResponses.length) * 100);
                html += `<li>${need} <span class="count">${count} (${percentage}%)</span></li>`;
            });
            
            html += `
                    </ul>
                </div>
            `;
            
            // Add past problems
            const pastProblems = allResponses
                .filter(r => r.past_problem && r.past_problem.trim())
                .map(r => r.past_problem);
            
            if (pastProblems.length > 0) {
                html += `
                    <div class="section" style="margin-top: 30px;">
                        <h3 class="section-title">âš ï¸ Ø£ÙƒØ¨Ø± Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù…Ù† Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                `;
                
                pastProblems.forEach((problem, index) => {
                    html += `
                        <div class="response-detail">
                            <p>${index + 1}. ${problem}</p>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // Add tools needed
            const toolsNeeded = allResponses
                .filter(r => r.needed_tools && r.needed_tools.trim())
                .map(r => r.needed_tools);
            
            if (toolsNeeded.length > 0) {
                html += `
                    <div class="section" style="margin-top: 30px;">
                        <h3 class="section-title">ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                `;
                
                toolsNeeded.forEach((tool, index) => {
                    html += `
                        <div class="response-detail">
                            <p>${index + 1}. ${tool}</p>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            container.innerHTML = html;
        }
        
        // Generate Insights
        function generateInsights() {
            const container = document.getElementById('insights-container');
            
            // Calculate key metrics
            const avgReadiness = parseFloat(document.getElementById('avg-readiness').textContent);
            const withPlansPercent = parseInt(document.getElementById('with-plans').textContent);
            
            const withTimeline = allResponses.filter(r => r.has_timeline === 'Ù†Ø¹Ù…ØŒ Ø¬Ø§Ù‡Ø² ÙˆÙ…ÙƒØªÙˆØ¨').length;
            const timelinePercent = Math.round((withTimeline / allResponses.length) * 100);
            
            const withBoard = allResponses.filter(r => r.board_setup === 'Ù†Ø¹Ù…ØŒ ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ø§Ø±Ù Ø¯ÙˆØ±Ù‡').length;
            const boardPercent = Math.round((withBoard / allResponses.length) * 100);
            
            const readyHighly = allResponses.filter(r => parseInt(r.readiness) >= 4).length;
            const highReadyPercent = Math.round((readyHighly / allResponses.length) * 100);
            
            let html = `
                <div class="recommendations">
                    <div class="recommendation-card">
                        <h4><span class="priority-high">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</span>Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„ØªÙ†Ø¸ÙŠÙ…</h4>
                        <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ${100 - withPlansPercent}% Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡Ù… Ø®Ø·Ø© ØªÙØµÙŠÙ„ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©.</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ÙŠØ¬Ø¨ ØªØ®ØµÙŠØµ Ø¬Ø²Ø¡ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„ÙˆØ±Ø´Ø© (Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø³Ø§Ø¹Ø©) Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¹Ù…Ù„ÙŠ Ù…Ø¹ Ù†Ù…Ø§Ø°Ø¬ Ø¬Ø§Ù‡Ø²Ø© ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙˆØ±Ø§Ù‹.</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4><span class="priority-high">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</span>Ø§Ù„ØªÙÙˆÙŠØ¶ ÙˆØªØ³ÙƒÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ø©</h4>
                        <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ${100 - boardPercent}% Ù„Ù… ÙŠØ³ÙƒÙ†ÙˆØ§ Ø§Ù„Ù‚Ø§Ø¯Ø© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ Ø£Ùˆ Ù„Ù… ÙŠØ³ÙƒÙ†ÙˆÙ‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚.</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ØªÙ…Ø±ÙŠÙ† Ø¹Ù…Ù„ÙŠ Ø¹Ù„Ù‰ ØªØ³ÙƒÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±Ø¯ Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø± Ø¨Ø¯Ù‚Ø©.</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4><span class="priority-medium">Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</span>Timeline ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h4>
                        <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> ${100 - timelinePercent}% Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡Ù… Timeline ÙˆØ§Ø¶Ø­ Ù…ÙƒØªÙˆØ¨.</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ØªÙ‚Ø¯ÙŠÙ… Ù†Ù…ÙˆØ°Ø¬ Timeline Ø¬Ø§Ù‡Ø² ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµÙ‡ Ù„ÙƒÙ„ Ù…Ø­Ø§ÙØ¸Ø©ØŒ Ù…Ø¹ Ø´Ø±Ø­ ÙƒÙŠÙÙŠØ© ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹.</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4><span class="priority-high">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</span>Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª</h4>
                        <p><strong>Ø§Ù„Ø­Ø§Ø¬Ø©:</strong> Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙŠÙˆØ§Ø¬Ù‡ÙˆÙ† Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ù…ØªÙƒØ±Ø±Ø© Ù…Ù† Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† ÙˆØ§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†.</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ØªØ®ØµÙŠØµ 20-30 Ø¯Ù‚ÙŠÙ‚Ø© Ù„ØªØ¯Ø±ÙŠØ¨ Ø¹Ù…Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ FEEL-FOUND-FIX Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©.</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4><span class="priority-medium">Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</span>Ø§Ù„ØªØ­ÙÙŠØ² ÙˆØ§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</h4>
                        <p><strong>Ø§Ù„ØªØ­Ø¯ÙŠ:</strong> ØªØ³Ø±Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† ÙˆÙ‚Ù„Ø© Ø§Ù„ØªØ­ÙÙŠØ² Ù…Ù† Ø£ÙƒØ«Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©.</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù€ 5 Ù„Ù„ØªØ­ÙÙŠØ² (Daily Check-in, Progress Board, Buddy System, Weekly Celebration, Personal Appreciation) Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ÙŠØ©.</p>
                    </div>
                    
                    <div class="recommendation-card">
                        <h4><span class="priority-low">Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</h4>
                        <p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© ${avgReadiness} Ù…Ù† 5ØŒ Ùˆ${highReadyPercent}% Ù„Ø¯ÙŠÙ‡Ù… Ø¬Ø§Ù‡Ø²ÙŠØ© Ø¹Ø§Ù„ÙŠØ© (4-5).</p>
                        <p><strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ù…Ù† Ù„Ø¯ÙŠÙ‡Ù… Ø¬Ø§Ù‡Ø²ÙŠØ© Ø¹Ø§Ù„ÙŠØ© ÙƒÙ€ "Champions" ÙŠØ³Ø§Ø¹Ø¯ÙˆÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØ±Ø´Ø©.</p>
                    </div>
                </div>
                
                <div class="ai-analysis">
                    <h3>ğŸ¤– ØªØ­Ù„ÙŠÙ„ AI - Ù†Ù‚Ø§Ø· Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
                    <div class="analysis-text" id="ai-quick-analysis">
                        <p><strong>1. Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ÙˆØ±Ø´Ø©:</strong></p>
                        <p>â€¢ Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¹Ù…Ù„ÙŠ (60% Ù…Ù† Ø§Ù„ÙˆÙ‚Øª)<br>
                        â€¢ Ø§Ù„ØªÙÙˆÙŠØ¶ ÙˆØªØ³ÙƒÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ø© (25%)<br>
                        â€¢ Ø§Ù„ØªØ­ÙÙŠØ² ÙˆØ§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª (15%)</p>
                        
                        <p><strong>2. Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong></p>
                        <p>â€¢ ÙƒÙ„ Ù…Ø´Ø§Ø±Ùƒ ÙŠØ®Ø±Ø¬ Ø¨Ø®Ø·Ø© ØªÙØµÙŠÙ„ÙŠØ© Ù…ÙƒØªÙˆØ¨Ø©<br>
                        â€¢ Ù†Ù…ÙˆØ°Ø¬ Timeline Ø¬Ø§Ù‡Ø²<br>
                        â€¢ Board structure ÙˆØ§Ø¶Ø­<br>
                        â€¢ Script Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ 5 Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                        
                        <p><strong>3. Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong></p>
                        <p>Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ØŒ Ø£ÙƒØ¨Ø± 3 ØªØ­Ø¯ÙŠØ§Øª Ù‡ÙŠ:<br>
                        â€¢ Ø¶Ø¹Ù Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø³Ø¨Ù‚<br>
                        â€¢ Ø¹Ø¯Ù… ÙˆØ¶ÙˆØ­ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª<br>
                        â€¢ ØªØ³Ø±Ø¨ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† ÙˆØ¶Ø¹Ù Ø§Ù„ØªØ­ÙÙŠØ²</p>
                        
                        <p><strong>4. Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong></p>
                        <p>Ø§Ù„ÙˆØ±Ø´Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 80% Ø¹Ù…Ù„ÙŠØ© ØªØ·Ø¨ÙŠÙ‚ÙŠØ© Ùˆ20% Ù†Ø¸Ø±ÙŠØ© ÙÙ‚Ø·. ÙƒÙ„ Ù…Ø´Ø§Ø±Ùƒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ´ØªØºÙ„ Ø¹Ù„Ù‰ Ø®Ø·ØªÙ‡ Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆØ±Ø´Ø©.</p>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Generate AI Analysis
        async function generateAIAnalysis() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
            
            try {
                // Prepare data summary for AI
                const summary = {
                    total: allResponses.length,
                    avgReadiness: parseFloat(document.getElementById('avg-readiness').textContent),
                    withPlans: document.getElementById('with-plans').textContent,
                    challenges: [],
                    needs: {},
                    objections: {}
                };
                
                // Collect data
                allResponses.forEach(r => {
                    if (r.challenge_1) summary.challenges.push(r.challenge_1);
                    if (r.challenge_2) summary.challenges.push(r.challenge_2);
                    if (r.challenge_3) summary.challenges.push(r.challenge_3);
                    
                    if (r.workshop_needs && Array.isArray(r.workshop_needs)) {
                        r.workshop_needs.forEach(need => {
                            summary.needs[need] = (summary.needs[need] || 0) + 1;
                        });
                    }
                });
                
                alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ! Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ AI Ù…ØªÙ‚Ø¯Ù…ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Claude AI.');
                
                // Copy summary to clipboard
                const summaryText = JSON.stringify(summary, null, 2);
                navigator.clipboard.writeText(summaryText);
                
                alert('ØªÙ… Ù†Ø³Ø® Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚Ù‡Ø§ ÙÙŠ Claude AI Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù….');
                
            } catch (error) {
                console.error('Error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¤– ØªØ­Ù„ÙŠÙ„ AI Ù…ØªÙ‚Ø¯Ù…';
            }
        }
        
        // Export to Excel
        function exportToExcel() {
            if (allResponses.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            // Prepare data for Excel
            const excelData = allResponses.map((r, index) => ({
                'Ø§Ù„Ø±Ù‚Ù…': index + 1,
                'Ø§Ù„Ø§Ø³Ù…': r.name || '',
                'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©': r.governorate || '',
                'Ø§Ù„Ø¯ÙˆØ±': r.role || '',
                'Ø¯ÙˆØ± Ø¢Ø®Ø±': r.role_other || '',
                'Ø§Ù„Ø®Ø·Ø©': r.has_plan || '',
                'ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª': r.target_divided || '',
                'Timeline': r.has_timeline || '',
                'ØªØ³ÙƒÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ø©': r.board_setup || '',
                'Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†': r.volunteers_count || '',
                'Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©': r.readiness || '',
                'Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙˆÙ„': r.challenge_1 || '',
                'Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ': r.challenge_2 || '',
                'Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø«Ø§Ù„Ø«': r.challenge_3 || '',
                'Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©': Array.isArray(r.workshop_needs) ? r.workshop_needs.join(', ') : '',
                'Ø£ÙƒØ¨Ø± Ù…Ø´ÙƒÙ„Ø© Ø³Ø§Ø¨Ù‚Ø©': r.past_problem || '',
                'Ø£Ù…Ø«Ù„Ø© Ù†Ø§Ø¬Ø­Ø©': r.success_example || '',
                'Ø£Ø¯ÙˆØ§Øª Ù…Ø­ØªØ§Ø¬Ø©': r.needed_tools || '',
                'Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†': Array.isArray(r.volunteer_objections) ? r.volunteer_objections.join(', ') : '',
                'Ø§Ø¹ØªØ±Ø§Ø¶Ø§Øª Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†': Array.isArray(r.donor_objections) ? r.donor_objections.join(', ') : '',
                'Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ·ÙˆØ¹': r.volunteer_response || '',
                'Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ¨Ø±Ø¹': r.donor_response || '',
                'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(r.timestamp).toLocaleString('ar-EG')
            }));
            
            // Create workbook
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª');
            
            // Add statistics sheet
            const stats = [
                ['Ø¥Ø­ØµØ§Ø¦ÙŠØ©', 'Ø§Ù„Ù‚ÙŠÙ…Ø©'],
                ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†', allResponses.length],
                ['Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª', document.getElementById('total-governorates').textContent],
                ['Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©', document.getElementById('avg-readiness').textContent],
                ['Ù„Ø¯ÙŠÙ‡Ù… Ø®Ø·Ø© Ø¬Ø§Ù‡Ø²Ø©', document.getElementById('with-plans').textContent]
            ];
            
            const wsStats = XLSX.utils.aoa_to_sheet(stats);
            XLSX.utils.book_append_sheet(wb, wsStats, 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
            
            // Download
            const fileName = `ramadan-campaign-survey_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // Helper Functions
        function countValues(field) {
            const counts = {};
            allResponses.forEach(r => {
                const value = r[field] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                counts[value] = (counts[value] || 0) + 1;
            });
            return counts;
        }
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function showEmptyState() {
            document.getElementById('loading').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>
                    <p style="color: #999; font-size: 14px;">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø¨Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</p>
                </div>
            `;
        }
        
        // Initialize
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
