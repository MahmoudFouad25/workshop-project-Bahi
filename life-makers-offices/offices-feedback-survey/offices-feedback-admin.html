<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Admin Dashboard - Ø§Ø³ØªÙ…Ø§Ø±Ø© ÙÙŠØ¯Ø¨Ø§Ùƒ Ø§Ù„Ù…ÙƒØ§ØªØ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }
        
        .tab:hover {
            background: #f5f7fa;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* Content Sections */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Data Card */
        .data-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .data-card-title {
            font-size: 22px;
            color: #333;
            font-weight: 700;
        }
        
        .data-timestamp {
            font-size: 14px;
            color: #999;
        }
        
        /* Question Block */
        .question-block {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-right: 4px solid #667eea;
        }
        
        .question-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }
        
        .question-answer {
            font-size: 15px;
            color: #555;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .question-answer.empty {
            color: #999;
            font-style: italic;
        }
        
        /* Section Header */
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 30px 0 20px 0;
            font-size: 18px;
            font-weight: 700;
        }
        
        /* Export Button */
        .export-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.3);
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 239, 125, 0.4);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Submissions List */
        .submissions-list {
            display: grid;
            gap: 20px;
        }
        
        .submission-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border-right: 4px solid #667eea;
        }
        
        .submission-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .submission-id {
            font-weight: 600;
            color: #667eea;
        }
        
        .submission-date {
            font-size: 14px;
            color: #999;
        }
        
        .submission-preview {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 40px;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .modal-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .container {
                padding: 0;
            }
            
            .header {
                border-radius: 0;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .data-card {
                padding: 20px;
            }
            
            .modal-content {
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .modal-header {
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š Admin Dashboard - Ø§Ø³ØªÙ…Ø§Ø±Ø© ÙÙŠØ¯Ø¨Ø§Ùƒ Ø§Ù„Ù…ÙƒØ§ØªØ¨</h1>
            <p>Ø¹Ø±Ø¶ ÙˆØªØ­Ù„ÙŠÙ„ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ø³ØªÙ…Ø§Ø±Ø© ØªØµÙ…ÙŠÙ… Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØ§ØªØ¨</p>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-label">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</div>
                <div class="stat-value" id="draft-status">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">âœ…</div>
                <div class="stat-label">Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                <div class="stat-value" id="submissions-count">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“…</div>
                <div class="stat-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
                <div class="stat-value" id="last-update" style="font-size: 18px;">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</div>
                <div class="stat-value" id="completion-rate">-%</div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('shared')">
                ğŸ“ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
            </button>
            <button class="tab" onclick="switchTab('submissions')">
                âœ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (<span id="submissions-count-tab">0</span>)
            </button>
        </div>
        
        <!-- Shared Form Content -->
        <div class="content-section active" id="shared-content">
            <div class="data-card">
                <div class="data-card-header">
                    <div class="data-card-title">ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</div>
                    <button class="export-btn" onclick="exportSharedData()">
                        ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
                
                <div id="shared-data-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Submissions Content -->
        <div class="content-section" id="submissions-content">
            <div class="data-card">
                <div class="data-card-header">
                    <div class="data-card-title">âœ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                    <button class="export-btn" onclick="exportAllSubmissions()">
                        ğŸ“¥ ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª
                    </button>
                </div>
                
                <div id="submissions-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Submission Details -->
    <div class="modal" id="submission-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</div>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script>
    const firebaseConfig = {
  apiKey: "AIzaSyAwgsHYsgV6W4WAZCIsaOXSlvw3sNHQS-Q",
  authDomain: "workshop-lifecycle-makers.firebaseapp.com",
  projectId: "workshop-lifecycle-makers",
  storageBucket: "workshop-lifecycle-makers.firebasestorage.app",
  messagingSenderId: "989952488845",
  appId: "1:989952488845:web:4e75745430c1e39e6ff9c4",
  measurementId: "G-8JYKNDE51B"
};
    </script>

    <!-- Main Script -->
    <script>
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const SHARED_DOC_ID = 'shared-feedback-form';
        
        // Questions mapping
        const questions = {
            // Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„
            'q1_differences': '1. Ù…Ù† ÙˆØ¬Ù‡Ø© Ù†Ø¸Ø±ÙƒØŒ Ø¥ÙŠÙ‡ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ø¨ÙŠÙ† "Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø´Ø±ÙŠÙƒØ©" Ùˆ"Ø§Ù„Ù…ÙƒØªØ¨"ØŸ',
            'q2_roles': '2. Ø¥ÙŠÙ‡ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…ÙƒØªØ¨ØŸ',
            'q3_structure': '3. Ø¥ÙŠÙ‡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ Ù„Ù„Ù…ÙƒØªØ¨ØŸ',
            'q4_challenges': '4. Ø¥ÙŠÙ‡ Ø£ÙƒØ¨Ø± 3 ØªØ­Ø¯ÙŠØ§Øª Ø¨ØªÙˆØ§Ø¬Ù‡ Ø§Ù„Ù…ÙƒØ§ØªØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ',
            
            // Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„
            'q5a_suitable': '5. Ø£) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„)',
            'q5b_unsuitable': '5. Ø¨) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„)',
            'q5c_missing': '5. Ø¬) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„)',
            'q5d_modifications': '5. Ø¯) Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­ØªØ§Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„)',
            
            // Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ
            'q6a_suitable_leadership': '6. Ø£) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„Ø±ÙˆØ­ ÙˆØ§Ù„Ù‚ÙŠØ§Ø¯Ø©)',
            'q6b_unsuitable_leadership': '6. Ø¨) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ)',
            'q6c_missing_leadership': '6. Ø¬) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ)',
            'q6d_modifications_leadership': '6. Ø¯) Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­ØªØ§Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ)',
            
            // Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«
            'q7a_suitable_performance': '7. Ø£) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡)',
            'q7b_unsuitable_performance': '7. Ø¨) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«)',
            'q7c_missing_performance': '7. Ø¬) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«)',
            'q7d_modifications_performance': '7. Ø¯) Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­ØªØ§Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«)',
            
            // Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹
            'q8a_suitable_resources': '8. Ø£) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹ - Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©)',
            'q8b_unsuitable_resources': '8. Ø¨) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…ÙƒØªØ¨ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹)',
            'q8c_missing_resources': '8. Ø¬) Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹)',
            'q8d_modifications_resources': '8. Ø¯) Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù…Ø­ØªØ§Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹)',
            
            // Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹
            'q9_top3_topics': '9. Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± 3 Ù…ÙˆØ¶ÙˆØ¹Ø§Øª ÙØ±Ø¹ÙŠØ© ÙÙ‚Ø· ØªØ´Ø®Ù‘Øµ Ø¨ÙŠÙ‡Ø§ ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙƒØªØ¨ØŒ Ù‡ØªØ®ØªØ§Ø± Ø¥ÙŠÙ‡ØŸ',
            'q10_distribution': '10. Ù„Ùˆ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨ Ù‡ØªØªÙƒÙˆÙ† Ù…Ù† 50 Ø³Ø¤Ø§Ù„ Ø¨Ø³ØŒ Ø¥ÙŠÙ‡ Ø§Ù„Ù…Ø­Ø§ÙˆØ± Ø§Ù„Ù„ÙŠ ØªØ§Ø®Ø¯ Ø§Ù„Ù†Ø³Ø¨ Ø¯ÙŠØŸ',
            'q11_key_indicator': '11. Ø¥ÙŠÙ‡ Ø§Ù„Ø­Ø§Ø¬Ø© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ù„ÙŠ Ù„Ùˆ ÙÙ‡Ù…Ù†Ø§Ù‡Ø§ Ø¹Ù† Ø§Ù„Ù…ÙƒØªØ¨ØŒ Ù‡Ù†Ø¹Ø±Ù "Ø§Ù„Ù…ÙƒØªØ¨ Ø¯Ù‡ Ù‚ÙˆÙŠ ÙˆÙ„Ø§ Ø¶Ø¹ÙŠÙ"ØŸ',
            'q12_ideal_office': '12. Ù„Ùˆ ØªØªØ®ÙŠÙ„ "Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ"ØŒ Ø¥ÙŠÙ‡ Ø£Ù‡Ù… 5 ØµÙØ§Øª ÙÙŠÙ‡ØŸ',
            'q13_completely_missing': '13. Ø¥ÙŠÙ‡ Ø§Ù„Ù„ÙŠ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø®Ø§Ù„Øµ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙ„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨ØŸ',
            'q14_general_notes': '14. Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
            'q15_additional': '15. ÙÙŠÙ‡ Ø­Ø§Ø¬Ø© Ø¹Ø§ÙŠØ² ØªØ¶ÙŠÙÙ‡Ø§ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø¯ÙŠØŸ'
        };
        
        // Section headers
        const sectionHeaders = {
            'q1_differences': 'ğŸ“ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: ÙÙ‡Ù… Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…ÙƒØªØ¨',
            'q5a_suitable': 'ğŸ—ï¸ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©',
            'q6a_suitable_leadership': 'ğŸ’ª Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø±ÙˆØ­ ÙˆØ§Ù„Ù‚ÙŠØ§Ø¯Ø©',
            'q7a_suitable_performance': 'ğŸ“Š Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø£Ø«Ø±',
            'q8a_suitable_resources': 'ğŸ’° Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©',
            'q9_top3_topics': 'ğŸ¯ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©'
        };
        
        // Load shared data
        async function loadSharedData() {
            try {
                const doc = await db.collection('offices-feedback-shared').doc(SHARED_DOC_ID).get();
                const container = document.getElementById('shared-data-container');
                
                if (doc.exists) {
                    const data = doc.data();
                    
                    // Update stats
                    updateSharedStats(data);
                    
                    // Display data
                    let html = '';
                    
                    Object.keys(questions).forEach(key => {
                        // Add section header if needed
                        if (sectionHeaders[key]) {
                            html += `<div class="section-header">${sectionHeaders[key]}</div>`;
                        }
                        
                        const answer = data[key] || '';
                        const isEmpty = !answer || answer.trim() === '';
                        
                        html += `
                            <div class="question-block">
                                <div class="question-label">${questions[key]}</div>
                                <div class="question-answer ${isEmpty ? 'empty' : ''}">
                                    ${isEmpty ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø¹Ø¯' : answer}
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø¨Ø¹Ø¯</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading shared data:', error);
                document.getElementById('shared-data-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âŒ</div>
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    </div>
                `;
            }
        }
        
        // Update shared stats
        function updateSharedStats(data) {
            // Count answered questions
            let answeredCount = 0;
            const totalQuestions = Object.keys(questions).length;
            
            Object.keys(questions).forEach(key => {
                if (data[key] && data[key].trim() !== '') {
                    answeredCount++;
                }
            });
            
            const completionRate = Math.round((answeredCount / totalQuestions) * 100);
            
            document.getElementById('draft-status').textContent = `${answeredCount} / ${totalQuestions}`;
            document.getElementById('completion-rate').textContent = `${completionRate}%`;
            
            // Last update
            if (data.lastSaved) {
                const date = data.lastSaved.toDate();
                document.getElementById('last-update').textContent = formatDate(date);
            } else if (data.lastSavedClient) {
                const date = new Date(data.lastSavedClient);
                document.getElementById('last-update').textContent = formatDate(date);
            }
        }
        
        // Load submissions
        async function loadSubmissions() {
            try {
                const snapshot = await db.collection('offices-feedback-submissions')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const container = document.getElementById('submissions-container');
                const count = snapshot.size;
                
                // Update counts
                document.getElementById('submissions-count').textContent = count;
                document.getElementById('submissions-count-tab').textContent = count;
                
                if (count === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø±Ø³Ø§Ù„Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="submissions-list">';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.createdAt ? data.createdAt.toDate() : new Date(data.submittedAt);
                    
                    // Get preview (first non-empty answer)
                    let preview = '';
                    for (let key of Object.keys(questions)) {
                        if (data[key] && data[key].trim() !== '') {
                            preview = data[key].substring(0, 150) + (data[key].length > 150 ? '...' : '');
                            break;
                        }
                    }
                    
                    html += `
                        <div class="submission-item" onclick="viewSubmission('${doc.id}')">
                            <div class="submission-header">
                                <div class="submission-id">ğŸ“„ ${doc.id}</div>
                                <div class="submission-date">${formatDate(date)}</div>
                            </div>
                            <div class="submission-preview">${preview || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰'}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading submissions:', error);
                document.getElementById('submissions-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âŒ</div>
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª</p>
                    </div>
                `;
            }
        }
        
        // View submission in modal
        async function viewSubmission(docId) {
            try {
                const doc = await db.collection('offices-feedback-submissions').doc(docId).get();
                
                if (!doc.exists) {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                    return;
                }
                
                const data = doc.data();
                const date = data.createdAt ? data.createdAt.toDate() : new Date(data.submittedAt);
                
                let html = `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: #667eea; margin-bottom: 5px;">ğŸ“„ ${docId}</div>
                                <div style="font-size: 14px; color: #999;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${formatDate(date)}</div>
                            </div>
                            <button class="export-btn" onclick="exportSubmission('${docId}')">
                                ğŸ“¥ ØªØµØ¯ÙŠØ±
                            </button>
                        </div>
                    </div>
                `;
                
                Object.keys(questions).forEach(key => {
                    if (sectionHeaders[key]) {
                        html += `<div class="section-header">${sectionHeaders[key]}</div>`;
                    }
                    
                    const answer = data[key] || '';
                    const isEmpty = !answer || answer.trim() === '';
                    
                    html += `
                        <div class="question-block">
                            <div class="question-label">${questions[key]}</div>
                            <div class="question-answer ${isEmpty ? 'empty' : ''}">
                                ${isEmpty ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©' : answer}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('modal-body').innerHTML = html;
                document.getElementById('submission-modal').classList.add('show');
                
            } catch (error) {
                console.error('Error viewing submission:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
            }
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('submission-modal').classList.remove('show');
        }
        
        // Close modal on background click
        document.getElementById('submission-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Switch tabs
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (tab === 'shared') {
                document.getElementById('shared-content').classList.add('active');
            } else {
                document.getElementById('submissions-content').classList.add('active');
            }
        }
        
        // Export shared data
        async function exportSharedData() {
            try {
                const doc = await db.collection('offices-feedback-shared').doc(SHARED_DOC_ID).get();
                
                if (!doc.exists) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }
                
                const data = doc.data();
                
                // Create CSV content
                let csv = '\uFEFF'; // UTF-8 BOM for Excel
                csv += 'Ø§Ù„Ø³Ø¤Ø§Ù„,Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©\n';
                
                Object.keys(questions).forEach(key => {
                    const question = questions[key].replace(/"/g, '""');
                    const answer = (data[key] || '').replace(/"/g, '""').replace(/\n/g, ' ');
                    csv += `"${question}","${answer}"\n`;
                });
                
                // Download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Ø§Ø³ØªÙ…Ø§Ø±Ø©_Ø§Ù„Ù…ÙƒØ§ØªØ¨_Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©_${Date.now()}.csv`;
                link.click();
                
            } catch (error) {
                console.error('Error exporting:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }
        
        // Export single submission
        async function exportSubmission(docId) {
            try {
                const doc = await db.collection('offices-feedback-submissions').doc(docId).get();
                
                if (!doc.exists) {
                    alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                    return;
                }
                
                const data = doc.data();
                
                // Create CSV content
                let csv = '\uFEFF';
                csv += 'Ø§Ù„Ø³Ø¤Ø§Ù„,Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©\n';
                
                Object.keys(questions).forEach(key => {
                    const question = questions[key].replace(/"/g, '""');
                    const answer = (data[key] || '').replace(/"/g, '""').replace(/\n/g, ' ');
                    csv += `"${question}","${answer}"\n`;
                });
                
                // Download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Ø¥Ø±Ø³Ø§Ù„_${docId}_${Date.now()}.csv`;
                link.click();
                
            } catch (error) {
                console.error('Error exporting:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }
        
        // Export all submissions
        async function exportAllSubmissions() {
            try {
                const snapshot = await db.collection('offices-feedback-submissions')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø±Ø³Ø§Ù„Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }
                
                // Create CSV content
                let csv = '\uFEFF';
                csv += 'Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø±Ø³Ø§Ù„,';
                csv += Object.values(questions).map(q => `"${q.replace(/"/g, '""')}"`).join(',');
                csv += '\n';
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.createdAt ? data.createdAt.toDate() : new Date(data.submittedAt);
                    
                    csv += `"${doc.id}","${formatDate(date)}",`;
                    csv += Object.keys(questions).map(key => {
                        const answer = (data[key] || '').replace(/"/g, '""').replace(/\n/g, ' ');
                        return `"${answer}"`;
                    }).join(',');
                    csv += '\n';
                });
                
                // Download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `ÙƒÙ„_Ø§Ù„Ø¥Ø±Ø³Ø§Ù„Ø§Øª_${Date.now()}.csv`;
                link.click();
                
            } catch (error) {
                console.error('Error exporting all:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±');
            }
        }
        
        // Format date
        function formatDate(date) {
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString('ar-EG', options);
        }
        
        // Initialize
        window.addEventListener('load', function() {
            loadSharedData();
            loadSubmissions();
            
            // Setup real-time listener for shared data
            db.collection('offices-feedback-shared').doc(SHARED_DOC_ID).onSnapshot(() => {
                loadSharedData();
            });
            
            // Setup real-time listener for submissions
            db.collection('offices-feedback-submissions').onSnapshot(() => {
                loadSubmissions();
            });
        });
        
    </script>
</body>
</html>
